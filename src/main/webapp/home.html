<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ProfitPal HomePage</title>
<style>
  
</style>
<link rel="stylesheet" href="style.css">

</head>
<body>
    <div class="header-container">
        <a href="home.html" class="no-underline">
            <div class="header">
                <h1>ProfitPal</h1>
            </div>
        </a>
    </div>  

    <div class="button-group">
	    <button class="button login" id="loginButton" onclick="loginPage()">Login</button>
	    <button class="button new-user" id="newUserButton" onclick="newUserPage()">New User</button>
	    <button class="button tracker" id="trackerButton" onclick="tracker()">Tracker</button>
    </div>
      
    <div class="test-container">
	    <!-- Testimonies -->
	    <div class="test">
		      <p>Testimony 1</p>
	    </div>
	    <div class="test">
	        <p>Testimony 2</p>
	    </div>
	    <div class="test">
	        <p>Testimony 3</p>
	    </div>
    </div> 
    <div class="img-container">
	    <!-- News -->
	    
	    <div class="card-img">
	    	<div class="iframely-embed"><div class="iframely-responsive" style="height: 100px; padding-bottom: 0;"><a href="https://www.bloomberg.com/markets" data-iframely-url="//iframely.net/d5jTwV7"></a></div></div><script async src="//iframely.net/embed.js"></script>
	    </div>
	    
	    <div class="card-img">
	    	<div class="iframely-embed"><div class="iframely-responsive" style="height: 100px; padding-bottom: 0;"><a href="https://www.forbes.com/sites/cicelyjones/2024/04/26/how-to-set-yourself-up-for-financial-success-in-your-20s/" data-iframely-url="//iframely.net/mla2nyi?card=small"></a></div></div> <script async src="//iframely.net/embed.js"></script>
	    </div>
	    
	    <div class="card-img">
	        <div class="iframely-embed"><div class="iframely-responsive" style="height: 100px; padding-bottom: 0;"><a href="https://markets.businessinsider.com/news/stocks/stock-market-today-light-april-jobs-report-bond-yields-tumbling-2024-5" data-iframely-url="//iframely.net/BIeEso2?card=small"></a></div></div><script async src="//iframely.net/embed.js"></script>
	    </div>
	</div>
	      
    <div class="container">
      <!-- Stocks -->
      <div class="card">
        <img src="img/ticker.png" alt="Stock 1" class="">
        <span>Stock 1</span>
      </div>
      <div class="card">
        <img src="img/ticker.png" alt="Stock 2" class="">
        <span>Stock 2</span>
      </div>
      <div class="card">
        <img src="img/ticker.png" alt="Stock 3" class="">
        <span>Stock 3</span>
      </div>
    </div>
	      s
      <div class="footer">
        <p>ProfitPal Copyright 2024</p>
      </div>
<script>
let params = {}
let regex = /([^&=]+)=([^&=]*)/g, m

while(m = regex.exec(location.href)){
	params[decodeURIComponent(m[1])] = decodeURIComponent(m[2])
}

if(Object.keys(params).length > 0){
	localStorage.setItem('authInfo', JSON.stringify(params))
	
	
	
	window.history.pushState({}, document.title,"/" + "ProfitPalTest/home.html")

	let info = JSON.parse(localStorage.getItem('authInfo'))
	console.log(JSON.parse(localStorage.getItem('authInfo')))
	localStorage.setItem('access_token', JSON.parse(localStorage.getItem("authInfo")).access_token)
	// console.log(info['access_token'])
	// console.log(info['expires_in'])
	
	fetch("https://www.googleapis.com/oauth2/v3/userinfo",{
		headers:{
			"Authorization": `Bearer ${localStorage.getItem("access_token")}`	
		}
	})
	.then((data) => data.json())
	.then((info) => {
		console.log(info)
		var fullname = (info.family_name + info.given_name)
		var email = fullname + "@gmail.com"
		var password = "password"
		var xhr = new XMLHttpRequest();
		var url = "OauthServlet";
		var encodeEmail = encodeURIComponent(email);
		var encodePassword = encodeURIComponent(password);
	    console.log("email entered " + email);
	    console.log("password entered " + password);
		var param = "email=" + encodeEmail + "&password=" + encodePassword;
	
		xhr.open("POST", url, true);
		xhr.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
		xhr.onreadystatechange = function() {
			if (xhr.readyState == XMLHttpRequest.DONE) {
				if (xhr.status == 200) {
					//valid response
					console.log("success");
					localStorage.setItem("user", email);
					//window.location.href = "home.html";
				} else {
					alert("Error: " + xhr.status);
				}
			}
		};
		xhr.send(param);
	})
}

// window.history.pushState({}, document.title,"/" + "ProfitPalTest/home.html")

/*
let info = JSON.parse(localStorage.getItem('authInfo'))
console.log(JSON.parse(localStorage.getItem('authInfo')))
localStorage.setItem('access_token', JSON.parse(localStorage.getItem("authInfo")).access_token)
// console.log(info['access_token'])
// console.log(info['expires_in'])

fetch("https://www.googleapis.com/oauth2/v3/userinfo",{
	headers:{
		"Authorization": `Bearer ${localStorage.getItem("access_token")}`	
	}
})
.then((data) => data.json())
.then((info) => {
	console.log(info)
	var fullname = (info.family_name + info.given_name)
	var email = fullname + "@gmail.com"
	var password = "password"
	var xhr = new XMLHttpRequest();
	var url = "OauthServlet";
	var encodeEmail = encodeURIComponent(email);
	var encodePassword = encodeURIComponent(password);
    console.log("email entered " + email);
    console.log("password entered " + password);
	var param = "email=" + encodeEmail + "&password=" + encodePassword;

	xhr.open("POST", url, true);
	xhr.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
	xhr.onreadystatechange = function() {
		if (xhr.readyState == XMLHttpRequest.DONE) {
			if (xhr.status == 200) {
				//valid response
				console.log("success");
				localStorage.setItem("user", email);
				//window.location.href = "home.html";
			} else {
				alert("Error: " + xhr.status);
			}
		}
	};
	xhr.send(param);
})*/

</script>
      </body>
      <script src="home.js"></script>
      </html>